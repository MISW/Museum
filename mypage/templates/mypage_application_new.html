{% extends 'base.html' %}

{% load static %}

{% block title %}
マイページ
{% endblock title %}

{% block main %}

<main role="main">

  <div class="container">
    <h1 class="">新規ゲーム申請</h1>
    <form id="myform" class="px-4" action="/mypage/new_application" method="post">
      <!--class="was-validated"-->
      {% csrf_token %}
      <div class="row form-group py-4">
        <label class="col-xs-12 col-sm-4 col-form-label" for="gameTitle">ゲームタイトル</label>
        <div class="col-xs-12 col-sm-8">
          <input class="form-control" id="gameTitle" name="gameTitle" type="text" placeholder="入力" required>
        </div>
      </div>


      <div class="row form-group py-3">
        <label class="col-xs-12 col-sm-4 col-form-label" for="introduction">ゲームの説明</label>
        <div class="col-xs-12 col-sm-8">
          <textarea class="form-control" id="introduction" name="introduction" rows="5" required></textarea>
        </div>
      </div>

      <div class="row form-group py-3">
        <label class="col-xs-12 col-sm-4 col-form-label">作成者</label>
        <div class="col-xs-12 col-sm-8">
          <input type="text" id="createdBy" name="createdBy" value="{{user.first_name}}" disabled></input>
          <p class="" data-toggle="collapse" href="#developer_div" aria-expanded="false" aria-controls="developer_div">
            <img src="../static/icons/plus.svg" width="25" alt="作成者追加">
            <span id="co_createdBy" class="bg-white pt-1 pb-1"></span>
          </p>
          <div class="collapse bg-light" id="developer_div">
            <p>申請者(あなた)以外の作成者:</p>
            <input type="checkbox" name="developer" id=""><label for="">name1</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name2</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name3</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name4</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name5</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name6_</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name7__</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name8</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">nam9</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name10_</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name11_</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">n12</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">na13</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">n14</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">n15</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">16</label><span>　</span>
            <input type="checkbox" name="developer" id=""><label for="">name17_</label><span>　</span>

          </div>
        </div>
      </div>

      <div class="row form-group py-3">
        <label class="col-xs-12 col-sm-4 col-form-label">ゲームカテゴリ</label>
        <div class="col-xs-12 col-sm-8">
          <select id="gameCategory" name="gameCategory" class="form-control" required>
            <option disabled selected value>選んでください</option>
            <option>RPG</option>
            <option>アクション</option>
            <option>シューティング</option>
            <option>パズル</option>
            <option>音ゲー</option>
            <option>その他</option>
          </select>
        </div>
      </div>


      <div class="row form-group py-3">
        <label class="col-xs-12 col-sm-4 col-form-label" for="gameImageInput">イメージ画像</label>
        <div class="col-xs-12 col-sm-8">
          <input type="file" class="form-control-file d-none hidden" id="gameImageInput" name="gameImageInput"
            accept="image/*" required>
          <label class="bor" for="gameImageInput"><img src="../static/icons/plus.svg" width="25" alt="画像追加"></label>
          <img class="img-fluid" id="gameImage" alt="画像を追加してください">
        </div>

      </div>

      <div class="row form-group py-3">
        <div class="col-xs-12 col-sm-4">
          <label class="col-form-label">対応機種</label>
        </div>
        <div class="col-xs-12 col-sm-8">
          <div>
            <input class="form-check-input" type="checkbox" id="check0" name="check0" data-toggle="collapse"
              data-target="#link0" href="#link0" aria-expanded="false" aria-controls="link0" value="">
            <label class="form-check-label" for="check0">ブラウザ</label>
            <div class="collapse" id="link0">
              <input type="url" class="col-xs-12" name="link_browser" placeholder="ダウンロードリンク">
            </div>
          </div>
          <div>
            <input class="form-check-input" type="checkbox" id="check1" name="check1" data-toggle="collapse"
              data-target="#link1" href="#link1" aria-expanded="false" aria-controls="link1">
            <label class="form-check-label" for="check1">Windows</label>
            <div class="collapse" id="link1">
              <input type="url" class="col-xs-12" name="link_Windows" placeholder="ダウンロードリンク">
            </div>
          </div>
          <div>
            <input class="form-check-input" type="checkbox" id="check2" name="check2" data-toggle="collapse"
              data-target="#link2" href="#link2" aria-expanded="false" aria-controls="link2">
            <label class="form-check-label" for="check2">Mac</label>
            <div class="collapse" id="link2">
              <input type="url" class="col-xs-12" name="link_Mac" placeholder="ダウンロードリンク">
            </div>
          </div>
          <div>
            <input class="form-check-input" type="checkbox" id="check3" name="check3" data-toggle="collapse"
              data-target="#link3" href="#link3" aria-expanded="false" aria-controls="link3">
            <label class="form-check-label" for="check3">Android</label>
            <div class="collapse" id="link3">
              <input type="url" class="col-xs-12" name="link_Android" placeholder="ダウンロードリンク">
            </div>
          </div>
          <div>
            <input class="form-check-input" type="checkbox" id="check4" name="check4" data-toggle="collapse"
              data-target="#link4" href="#link4" aria-expanded="false" aria-controls="link4">
            <label class="form-check-label" for="check4">iOS</label>
            <div class="collapse" id="link4">
              <input type="url" class="col-xs-12" name="link_iOS" placeholder="ダウンロードリンク">
            </div>
          </div>

        </div>
      </div>

      <div class="p-5">
        <button type="submit" id="submit" class="btn btn-primary pr-4 pl-4 align-content-center"> 申請 </button>
        <!--type="submit"-->
      </div>

    </form>
  </div>


</main>

<script>
  $(function () {

    //画像変更
    $("#gameImageInput").on('change', function (e) {
      if (!e.target.files[0]) {
        $("#gameImage").attr('src', "");
        return;
      }

      var reader = new FileReader();
      reader.onload = function (e) {
        $("#gameImage").attr('src', e.target.result);
        $("#gameImage").attr('width', 256 + "px");
      }
      reader.readAsDataURL(e.target.files[0]);
    });


    //共同作成者
    $('input[name="developer"]').on('change', function () {
      var co_developers = "";
      $('input[name="developer"]:checked').each(function () {
        co_developers += $(this).next("label").text() + ",  ";
      });
      $("#co_createdBy").text(co_developers);
    });


    //linkの必要不必要管理  見たらわかるようにele→label→div↓input　という厳密な順番でないと使えない
    function link_required_prop(ele) {
      ele.on('change', function () {
        if ($(this).prop('checked')) {
          $(this).next('label').next('div').children('input').prop('required', true);
        } else {
          $(this).next('label').next('div').children('input').prop('required', false);
          $(this).next('label').next('div').children('input').val(""); //入力を消す
        }
      });
    }
    link_required_prop($("#check0"));
    link_required_prop($("#check1"));
    link_required_prop($("#check2"));
    link_required_prop($("#check3"));
    link_required_prop($("#check4"));





    //ページ移動警告
    $("input[type=submit]").click(function () {
      $(window).off('beforeunload');
    });
    $("input").change(function () {
      $(window).on('beforeunload', function (e) {
        return '入力済みデータが失われます。このまま移動しますか？\n申請する場合は「このまま移動する」を押してください。';
      });
    });





    //formの中身をalertで表示
    $('#myform').submit(
      //$('#submit').click(
      function () {
        var message = "";
        message += "ゲームタイトル: " + $("#gameTitle").val();
        message += "\nゲームの説明: " + $("#introduction").val();
        message += "\n作成者: " + "your name";
        message += "\n作成者（申請者以外）: ";
        $('input[name="developer"]:checked').each(function () {
          message += $(this).next("label").text() + ",  ";
        });

        message += "\nゲームカテゴリ：　" + $('#gameCategory option:selected').text();

        //message+="\nイメージ画像: "+$("#gameImage").val();

        message += "\nダウンロードリンク: ";
        if ($("#check0:checked").val()) message += "\nブラウザ: " + $("#link0").children("input").val();
        if ($("#check1:checked").val()) message += "\nWindows: " + $("#link1").children("input").val();
        if ($("#check2:checked").val()) message += "\nMac: " + $("#link2").children("input").val();
        if ($("#check3:checked").val()) message += "\nAndrois: " + $("#link3").children("input").val();
        if ($("#check4:checked").val()) message += "\niOS: " + $("#link4").children("input").val();


        message += "\n\nで申請します。";
        alert(message);

      }
    );



  });
</script>

</body>

</html>
{% endblock main %}